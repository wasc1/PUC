//https://www.yumpu.com/pt/document/read/37588299/formato-de-arquivo-bmp - Referencia
//Deixa a imagem negativa. Formato BMP 512x512

#include <stdio.h>

#define TAM 262090

unsigned char header[54]; //Armazenar o header completo de uma imagem bmp. 14bytes de cabe√ßalho de arquivo e 40 bytes de mapa de bits
unsigned char colorTable[1024]; //Armazenar a coloracao, caso exista.

int main(){

FILE *arq, *saida; //Ponteiros de entrada e saida de arquivos.
int i;

arq = fopen("lena512.bmp", "rb"); //Abre arquivo de imagem.

  for(i=0; i<54; i++){
    header[i] = getc(arq);
  }
    int width = *(int *) &header[18];
    int height = *(int *) &header[22];
    int bitDepth = *(int *) &header[28];

    if(bitDepth <= 8){
        fread(colorTable, sizeof(unsigned char), 1024, arq);
    }

    unsigned char buf[height * width];
    fread(buf, sizeof(unsigned char), (height * width), arq);

    unsigned char *pont = buf;
    unsigned char body[TAM];

    for(i=0;i<TAM;i++){
        body[i] = 255 - pont[i];
    }

    saida = fopen("./copy.bmp", "wb");

    fwrite(header, sizeof(unsigned char), 54, saida);

    if(bitDepth <= 8){
        fwrite(colorTable, sizeof(unsigned char), 1024, saida);
    }

    fwrite(body, sizeof(unsigned char), (height * width), saida);

    fclose(saida);
    fclose(arq);
return 0;
}
